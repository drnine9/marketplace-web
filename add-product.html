<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>إضافة سلعة</title>
  <style>
    body { font-family:"Cairo",sans-serif; direction:rtl; background:#f9fafb; padding:16px; }
    .card { background:#fff; padding:16px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.06); margin-bottom:14px; }
    label { display:block; margin:8px 0 4px; font-size:14px; color:#374151; }
    input, textarea { width:100%; padding:12px; border:1px solid #e5e7eb; border-radius:8px; }
    .btn { width:100%; padding:12px; background:#1f6feb; color:#fff; border:none; border-radius:8px; cursor:pointer; margin-top:10px; }
    .note { font-size:13px; color:#6b7280; }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h2>➕ إضافة سلعة</h2>
  <div class="card">
    <label>اسم السلعة</label>
    <input id="title" type="text" placeholder="مثال: موبايل مستعمل"/>
    <label>الوصف</label>
    <textarea id="desc" rows="4" placeholder="اكتب وصف موجز"></textarea>
    <label>السعر بالجنيه</label>
    <input id="price" type="number" min="1" placeholder="مثال: 1500"/>
    <label>صورة السلعة</label>
    <input id="photo" type="file" accept="image/*"/>
    <div class="note">رسوم إضافة السلعة الأولى: 5 جنيه (إنستا باي/فودافون كاش: 01021221872 أو 01008362452)</div>
    <button class="btn" onclick="submitProduct()">إرسال</button>
  </div>
  <script>
    const tg = window.Telegram.WebApp; tg.expand();
    async function fileToBase64(input){
      const f = input.files[0]; if(!f) return null;
      return new Promise((res,rej)=>{
        const r = new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(f);
      });
    }
    async function submitProduct(){
      const payload = {
        action: "add_product",
        title: document.getElementById("title").value?.trim(),
        desc: document.getElementById("desc").value?.trim(),
        price: Number(document.getElementById("price").value),
        photo: await fileToBase64(document.getElementById("photo"))
      };
      if(!payload.title || !payload.price) return alert("أكمل الاسم والسعر.");
      tg.sendData(JSON.stringify(payload));
      tg.showPopup({ title:"تم", message:"تم إرسال السلعة—سيتم طلب دفع 5 جنيه أو فتح إضافة مجانية عبر الإحالة.", buttons:[{type:"close"}] });
      tg.close();
    }
  </script>
</body>
</html>